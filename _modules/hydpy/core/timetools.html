<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>hydpy.core.timetools &#8212; HydPy 2.0.0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 2.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for hydpy.core.timetools</h1><div class="highlight"><pre>
<span></span>
<span class="sd">&quot;&quot;&quot;This module specifies how  dates and periods are handled in HydPy.</span>

<span class="sd">The following classes are implemented:</span>
<span class="sd">    * :class:`Date`: Defines a single time point.</span>
<span class="sd">    * :class:`Period`: Defines a single time duration.</span>
<span class="sd">    * :class:`Timegrid`: Defines an equidistant sequence of time points.</span>
<span class="sd">    * :class:`Timegrids`: Handles all :class:`Timegrid` instances of a</span>
<span class="sd">      HydPy project.</span>


<span class="sd">Date and Period</span>
<span class="sd">===============</span>

<span class="sd">Both classes :class:`Date` and :class:`Period` are build on top of the Python</span>
<span class="sd">module :mod:`datetime`. In essence, they wrap the :mod:`datetime` classes</span>
<span class="sd">:class:`~datetime.datetime` and :class:`~datetime.timedelta`, and are supposed</span>
<span class="sd">to specialise these general classes on the needs of HydPy users.</span>

<span class="sd">Be aware of the different minimum time resolution of module :mod:`datetime`</span>
<span class="sd">(microseconds) and module :mod:`~hydpy.core.timetools` (seconds).</span>

<span class="sd">:class:`Date` objects can be initialized via :class:`~datetime.datetime`</span>
<span class="sd">objects directly, e.g.::</span>

<span class="sd">    from datetime import datetime</span>
<span class="sd">    from hydpy.core.timetools import Date</span>

<span class="sd">    # Initialize a `datetime` object...</span>
<span class="sd">    datetime_object = datetime(1996, 11, 1, 0, 0, 0)</span>
<span class="sd">    # ...and use it to initialise a `Date` object.</span>
<span class="sd">    date1 = Date(datetime_object)</span>

<span class="sd">Alternatively, one can use :class:`str` objects as initialization arguments,</span>
<span class="sd">which need to match one of the following format styles::</span>

<span class="sd">    # The `os` style without empty space and colon, which is applied in</span>
<span class="sd">    # text files and folder names:</span>
<span class="sd">    date2 = Date(&#39;1997_11_01_00_00_00&#39;)</span>
<span class="sd">    # The `iso` style, which is more legible and in accordance with the</span>
<span class="sd">    # international ISO norm:</span>
<span class="sd">    date2 = Date(&#39;1997.11.01 00:00:00&#39;)</span>
<span class="sd">    # The `din` style, which is more legible for users in countries where the</span>
<span class="sd">    # position of day and year are interchanged (DIN refers to a german norm):</span>
<span class="sd">    date2 = Date(&#39;01.11.1997 00:00:00&#39;)</span>

<span class="sd">:class:`Date` keeps the chosen style in mind and uses it for printing.  But</span>
<span class="sd">the user is also allowed to change it::</span>

<span class="sd">    # Print in accordance with the `iso` style...</span>
<span class="sd">    print(date2.string(&#39;iso&#39;))</span>
<span class="sd">    # ...without changing the memorized `din` style:</span>
<span class="sd">    print(date2.style)</span>
<span class="sd">    # Alternatively, the style property can be set permanentely:</span>
<span class="sd">    date2.style = &#39;iso&#39;</span>
<span class="sd">    print(date2)</span>

<span class="sd">It is allowed to abbreviate the input strings. Using the `iso` style as an</span>
<span class="sd">example::</span>

<span class="sd">    # The following three input arguments...</span>
<span class="sd">    test1 = Date(&#39;1996.11.01 00:00:00&#39;)</span>
<span class="sd">    test2 = Date(&#39;1996.11.01 00:00&#39;)</span>
<span class="sd">    test3 = Date(&#39;1996.11.01 00&#39;)</span>
<span class="sd">    test4 = Date(&#39;1996.11.01&#39;)</span>
<span class="sd">    # ...all lead to identical `Date` instances.</span>
<span class="sd">    print(test1, test2, test3, test4)</span>

<span class="sd">If :class:`Date` has not been initialized via a :class:`str` object and the</span>
<span class="sd">style property has not been set manually, the default style `iso` is selected.</span>

<span class="sd">One can change the year, month... of a :class:`Date` object via numbers::</span>

<span class="sd">    # Assign an integer...</span>
<span class="sd">    test4.year = 1997</span>
<span class="sd">    # ...or something that can be converted to an integer.</span>
<span class="sd">    test4.month = &#39;10&#39;</span>
<span class="sd">    print(test4)</span>

<span class="sd">One can ask for the actual water year, which depends on the selected</span>
<span class="sd">reference month::</span>

<span class="sd">    oct = Date(&#39;1996.10.01&#39;)</span>
<span class="sd">    nov = Date(&#39;1996.11.01&#39;)</span>
<span class="sd">    # Under the standard settings, the water year is assumed to start November.</span>
<span class="sd">    print(oct.wateryear, nov.wateryear)</span>
<span class="sd">    # Changing the reference month via one `Date` object affects all objects.</span>
<span class="sd">    test4.refmonth = 10</span>
<span class="sd">    print(oct.wateryear, nov.wateryear)</span>
<span class="sd">    test4.refmonth = &#39;November&#39;</span>
<span class="sd">    print(oct.wateryear, nov.wateryear)</span>


<span class="sd">:class:`Period` objects can be directly initialized via</span>
<span class="sd">:class:`~datetime.timedelta` objects, e.g.::</span>

<span class="sd">    from datetime import timedelta</span>
<span class="sd">    from hydpy.core.timetools import Period</span>

<span class="sd">    # Initialize a `timedelta` object...</span>
<span class="sd">    timedelta_object = timedelta(1, 0)</span>
<span class="sd">    # ...and use it to initialise a `Period` object</span>
<span class="sd">    period = Period(timedelta_object)</span>

<span class="sd">Alternatively, one can initialize from :class:`str` objects.  These must</span>
<span class="sd">consist of some characters defining an integer value directly followed by</span>
<span class="sd">a single character defining the unit::</span>

<span class="sd">    # 30 seconds:</span>
<span class="sd">    period = Period(&#39;30s&#39;)</span>
<span class="sd">    # 5 minutes:</span>
<span class="sd">    period = Period(&#39;5m&#39;)</span>
<span class="sd">    # 6 hours:</span>
<span class="sd">    period = Period(&#39;6h&#39;)</span>
<span class="sd">    # 1 day:</span>
<span class="sd">    period = Period(&#39;1d&#39;)</span>

<span class="sd">:class:`Period` always determines the unit leading to the most legigible</span>
<span class="sd">print out::</span>

<span class="sd">    # Print using the unit leading to the smallest integer value:</span>
<span class="sd">    print(period)</span>
<span class="sd">    # Alternatively, the values of all time units are directly available as</span>
<span class="sd">    # `float` objects:</span>
<span class="sd">    print(period.days)</span>
<span class="sd">    print(period.hours)</span>
<span class="sd">    print(period.minutes)</span>
<span class="sd">    print(period.seconds)</span>

<span class="sd">If considered useful, logic and arithmetic operations are supported.</span>
<span class="sd">Some examples::</span>

<span class="sd">    # Determine the period length between two dates.</span>
<span class="sd">    wholeperiod = date2 - date1</span>
<span class="sd">    print(wholeperiod)</span>
<span class="sd">    # Determine, how often one period fits into the other.</span>
<span class="sd">    print(wholeperiod / period)</span>
<span class="sd">    # Get one sixths of period:</span>
<span class="sd">    print(period / 6)</span>
<span class="sd">    # But when trying to get one seventh of period:</span>
<span class="sd">    print(period / 7)</span>
<span class="sd">    # Double a period duration.</span>
<span class="sd">    period *= 2</span>
<span class="sd">    print(period)</span>
<span class="sd">    # Shift a date.</span>
<span class="sd">    date1 -= period</span>
<span class="sd">    # Note that the modulo operator returns a boolean value, indicating</span>
<span class="sd">    # whether the remainder is zero or not:</span>
<span class="sd">    # print(Period(&#39;1d&#39;) % Period(&#39;12h&#39;))</span>
<span class="sd">    # print(Period(&#39;1d&#39;) % Period(&#39;13h&#39;))</span>
<span class="sd">    # Following the same line of thinking, floor division leads to the</span>
<span class="sd">    # opposite results:</span>
<span class="sd">    # print(Period(&#39;1d&#39;) // Period(&#39;12h&#39;))</span>
<span class="sd">    # print(Period(&#39;1d&#39;) // Period(&#39;13h&#39;))</span>
<span class="sd">    # Compare dates or periods.</span>
<span class="sd">    print(date1 &lt; date2)</span>
<span class="sd">    print(min(date1, date2))</span>
<span class="sd">    print(period == wholeperiod)</span>
<span class="sd">    # Operations on initialisation arguments are supported.</span>
<span class="sd">    print(date1 + &#39;5m&#39;)</span>
<span class="sd">    print(period != &#39;12h&#39;)</span>

<span class="sd">Note that :class:`Date` and :class:`Period` objects are mutable.  Use their</span>
<span class="sd">`copy` methods whenever this might lead to unintentional results::</span>

<span class="sd">    # A date example:</span>
<span class="sd">    date1 = Date(&#39;1996.11.01 00:00&#39;)</span>
<span class="sd">    date2 = date1</span>
<span class="sd">    date3 = date1.copy()</span>
<span class="sd">    date1.year = 1997</span>
<span class="sd">    print(date1, date2, date3)</span>
<span class="sd">    # A period example:</span>
<span class="sd">    period1 = Period(&#39;1h&#39;)</span>
<span class="sd">    period2 = period1</span>
<span class="sd">    period3 = period1.copy()</span>
<span class="sd">    period1 -= &#39;2h&#39;</span>
<span class="sd">    print(period1, period2, period3)</span>



<span class="sd">Timegrid and Timegrids</span>
<span class="sd">======================</span>

<span class="sd">In hydrological modelling, input (and output) data are usually only available</span>
<span class="sd">with a certain resolution, which also determines the possible resolution</span>
<span class="sd">of the actual simulation.  This is reflected by the class :class:`Timegrid`,</span>
<span class="sd">which represents the first and the last date of e.g. a simulation period as</span>
<span class="sd">well as the intermediate dates. A :class:`Timegrid` object is initialized</span>
<span class="sd">by defining its first date, its last date and its stepsize::</span>

<span class="sd">    from hydpy.core.timetools import Date, Period, Timegrid</span>

<span class="sd">    # Either pass the proper attributes directly...</span>
<span class="sd">    firstdate = Date(&#39;1996.11.01&#39;)</span>
<span class="sd">    lastdate = Date(&#39;1997.11.01&#39;)</span>
<span class="sd">    stepsize = Period(&#39;1d&#39;)</span>
<span class="sd">    timegrid_sim = Timegrid(firstdate, lastdate, stepsize)</span>
<span class="sd">    # ...or pass their initialization arguments:</span>
<span class="sd">    timegrid_sim = Timegrid(&#39;1996.11.01&#39;, &#39;1997.11.01&#39;, &#39;1d&#39;)</span>

<span class="sd">:class:`Timegrid` provides functionalities to ease and secure the handling</span>
<span class="sd">of dates in HydPy. Here some examples::</span>

<span class="sd">    # Retrieve a date via indexing, e.g. the second one:</span>
<span class="sd">    date = timegrid_sim[1]</span>
<span class="sd">    print(date)</span>
<span class="sd">    # Or the other way round, retrieve the index belonging to a date:</span>
<span class="sd">    print(timegrid_sim[date])</span>
<span class="sd">    # Indexing beyond the ranges of the actual time period is allowed:</span>
<span class="sd">    print(timegrid_sim[-366])</span>
<span class="sd">    print(timegrid_sim[timegrid_sim[date+&#39;365d&#39;]])</span>
<span class="sd">    # Iterate through all time grid points (e.g. to print the first day of</span>
<span class="sd">    # each month):</span>
<span class="sd">    for date in timegrid_sim:</span>
<span class="sd">        if date.day == 1:</span>
<span class="sd">            print date</span>

<span class="sd">After doing some changes one should call the :func:`~Timegrid.verify` method::</span>

<span class="sd">    # `verify` keeps silent if everything seems to be alright...</span>
<span class="sd">    timegrid_sim.verify()</span>
<span class="sd">    # ...but raises an suitable exception otherwise:</span>
<span class="sd">    timegrid_sim.firstdate.minute = 30</span>
<span class="sd">    timegrid_sim.verify()</span>

<span class="sd">One can check two :class:`Timegrid` instances for equality::</span>

<span class="sd">    # Make a deep copy of the timegrid already existing.</span>
<span class="sd">    timegrid_test = timegrid_sim.copy()</span>
<span class="sd">    # Test for equality and non-equality.</span>
<span class="sd">    print(timegrid_sim == timegrid_test)</span>
<span class="sd">    print(timegrid_sim != timegrid_test)</span>
<span class="sd">    # Modify one date of the new timegrid.</span>
<span class="sd">    timegrid_test.firstdate += &#39;1d&#39;</span>
<span class="sd">    # Again, test for equality and non-equality.</span>
<span class="sd">    print(timegrid_sim == timegrid_test)</span>
<span class="sd">    print(timegrid_sim != timegrid_test)</span>

<span class="sd">Also, one can check if a date or even whole timegrid lies within a span</span>
<span class="sd">defined by a :class:`Timegrid` instance::</span>

<span class="sd">    # Define a long timegrid...</span>
<span class="sd">    timegrid_long = Timegrid(&#39;1996.11.01&#39;, &#39;2006.11.01&#39;, &#39;1d&#39;)</span>
<span class="sd">    # ...and check different dates for lying in the defined time period:</span>
<span class="sd">    print(&#39;1996.10.31&#39; in timegrid_long)</span>
<span class="sd">    print(&#39;1996.11.01&#39; in timegrid_long)</span>
<span class="sd">    print(&#39;1996.11.02&#39; in timegrid_long)</span>
<span class="sd">    # For dates not alligned on the grid `False` is returned:</span>
<span class="sd">    print(&#39;1996.11.01 12:00&#39; in timegrid_long)</span>

<span class="sd">    # Now define a timegrid containing only the first year of the long one:</span>
<span class="sd">    timegrid_short = Timegrid(&#39;1996.11.01&#39;, &#39;1997.11.01&#39;, &#39;1d&#39;)</span>
<span class="sd">    # Check which timegrid is contained by the other:</span>
<span class="sd">    print(timegrid_short in timegrid_long)</span>
<span class="sd">    print(timegrid_long in timegrid_short)</span>
<span class="sd">    # For timegrids with different stepsizes `False` is returned:</span>
<span class="sd">    timegrid_short.stepsize = Period(&#39;1h&#39;)</span>
<span class="sd">    print(timegrid_short in timegrid_long)</span>


<span class="sd">The HydPy framework distinguishes three `time frames`, one associated with the</span>
<span class="sd">input date available on disk (`data`), one associated, with the initialisation</span>
<span class="sd">period (`init`) and and one associated with the actual simulation period</span>
<span class="sd">(`sim`).  Each time frame is represented by a single :class:`Timegrid` object</span>
<span class="sd">and all together are handled by one class :class:`Timegrids` object.</span>

<span class="sd">There is usually only one :class:`Timegrids` object required within each</span>
<span class="sd">HydPy project.  It is automatically added to the module</span>
<span class="sd">:mod:`~hydpy.core.pub` during the initialization of a</span>
<span class="sd">:class:`~hydpy.core.hydpy.HydPy` object::</span>

<span class="sd">    from hydpy import HydPy</span>
<span class="sd">    from hydpy.core import pub</span>

<span class="sd">    hydpy = HydPy(&#39;tutorial_1&#39;)</span>
<span class="sd">    print(pub.timegrids)</span>

<span class="sd">Some examples on the usage of this :class:`Timegrids` instance::</span>

<span class="sd">    # Get the factor to convert `mm/stepsize` to m^3/s for an area of 36 km^2:</span>
<span class="sd">    print(pub.timegrids.qfactor(36.))</span>
<span class="sd">    # Get the index of the first values of the `data time frame` which belong</span>
<span class="sd">    # to the `initialisation time frame`.</span>
<span class="sd">    print(pub.timegrids.data[pub.timegrids.init.firstdate])</span>
<span class="sd">    # Or, as a similar example, get the index of the first values of the</span>
<span class="sd">    # `initialisation time frame` which belong to the `simulation time frame`.</span>
<span class="sd">    print(pub.timegrids.init[pub.timegrids.sim.firstdate])</span>

<span class="sd">Notice, that the latter index is zero.  This is due to the simulation time</span>
<span class="sd">frame beeing identical with the initialisation time frame, if not specified</span>
<span class="sd">otherwise in the main control file or by manually changing the simulation time</span>
<span class="sd">frame.</span>

<span class="sd">Each manual change should be followed by calling the</span>
<span class="sd">:func:`~Timegrids.verify` method, which calls the :func:`~Timegrid.verify`</span>
<span class="sd">method of the single :class:`Timegrid` instances and performs some additional</span>
<span class="sd">tests::</span>

<span class="sd">    # Postponing the `simulation time frame` one stepsize is fine...</span>
<span class="sd">    pub.timegrids.sim.firstdate += pub.timegrids.stepsize</span>
<span class="sd">    pub.timegrids.verify()</span>
<span class="sd">    # ...but shifting it outside the `initialisation time frame` or setting</span>
<span class="sd">    # it in  between the time grid points results in an error:</span>
<span class="sd">    pub.timegrids.sim.firstdate -= 2*pub.timegrids.stepsize</span>
<span class="sd">    pub.timegrids.verify()</span>
<span class="sd">    pub.timegrids.sim.firstdate += pub.timegrids.stepsize</span>
<span class="sd">    pub.timegrids.sim.firstdate.minute = 1</span>
<span class="sd">    pub.timegrids.verify()</span>


<span class="sd">To facilitate printing to configuration files, both classes :class:`Timegrid`</span>
<span class="sd">and :class:`Timegrids` allow for a extended canonical string representations</span>
<span class="sd">of their objects::</span>

<span class="sd">    # The string representation is generally formated with indentation.</span>
<span class="sd">    print(repr(pub.timegrids.data))</span>
<span class="sd">    print(repr(pub.timegrids))</span>
<span class="sd">    # The class specific `assignrepr` methods allow for inserting assignements.</span>
<span class="sd">    print(pub.timegrids.data.assignrepr(&#39;timegrid_data = &#39;))</span>
<span class="sd">    print(pub.timegrids.assignrepr(&#39;timegrids_all = &#39;))</span>


<span class="sd">Details</span>
<span class="sd">=======</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># import...</span>
<span class="c1"># ...from standard library</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="c1"># ...from third party packages</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="c1"># ...from HydPy</span>
<span class="kn">from</span> <span class="nn">hydpy.core</span> <span class="k">import</span> <span class="n">objecttools</span>

<span class="c1"># The import of `_strptime` is not thread save.  The following call of</span>
<span class="c1"># `strptime` is supposed to prevent possible problems arising from this bug.</span>
<span class="n">time</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s1">&#39;1999&#39;</span><span class="p">,</span> <span class="s1">&#39;%Y&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="Date"><a class="viewcode-back" href="../../../timetools.html#hydpy.core.timetools.Date">[docs]</a><span class="k">class</span> <span class="nc">Date</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Handles a single date.</span>

<span class="sd">    Argument:</span>
<span class="sd">        * date (:class:`~datetime.datetime` or :class:`str`): Initialization</span>
<span class="sd">          date.</span>

<span class="sd">    Attribute:</span>
<span class="sd">        * datetime (:class:`~datetime.datetime`): The core of :class:`Date`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># These are the so far accepted date format strings.</span>
    <span class="n">_formatstrings</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;os&#39;</span><span class="p">:</span> <span class="s1">&#39;%Y_%m_</span><span class="si">%d</span><span class="s1">_%H_%M_%S&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;iso&#39;</span><span class="p">:</span> <span class="s1">&#39;%Y.%m.</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;din&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">.%m.%Y %H:%M:%S&#39;</span><span class="p">}</span>
    <span class="c1"># The first month of the hydrological year (e.g. November in Germany)</span>
    <span class="n">_firstmonth_wateryear</span> <span class="o">=</span> <span class="mi">11</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">Date</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">datetime</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">date</span><span class="o">.</span><span class="n">microsecond</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;For `Date` instances, the microsecond must &#39;</span>
                                 <span class="s1">&#39;be `0`.  For the given `datetime` object, &#39;</span>
                                 <span class="s1">&#39;it is `</span><span class="si">%d</span><span class="s1">` instead.&#39;</span> <span class="o">%</span> <span class="n">date</span><span class="o">.</span><span class="n">microsecond</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="n">date</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initfromstr</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;The supplied argument must be either an &#39;</span>
                            <span class="s1">&#39;instance of `datetime.datetime` or of `str`.  &#39;</span>
                            <span class="s1">&#39;The given arguments type is </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">date</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_initfromstr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Try to initialize `datetime` from the given :class:`str` instance.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            * date (:class:`str`): Initialization date.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">style</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatstrings</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="o">=</span> <span class="n">style</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">string</span> <span class="o">=</span> <span class="n">string</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Date could not be identified out of the given &#39;</span>
                             <span class="s1">&#39;string </span><span class="si">%s</span><span class="s1">.  The available formats are </span><span class="si">%s</span><span class="s1">.&#39;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatstrings</span><span class="p">))</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Date.fromarray"><a class="viewcode-back" href="../../../timetools.html#hydpy.core.timetools.Date.fromarray">[docs]</a>    <span class="k">def</span> <span class="nf">fromarray</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a :class:`Date` instance based on date information (year,</span>
<span class="sd">        month, day, hour, minute, second) stored as the first entries of the</span>
<span class="sd">        successive rows of a :class:`~numpy.ndarray` object.&quot;&quot;&quot;</span>
        <span class="n">intarray</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span><span class="p">):</span>
            <span class="n">intarray</span> <span class="o">=</span> <span class="n">intarray</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">*</span><span class="n">intarray</span><span class="p">))</span></div>

<div class="viewcode-block" id="Date.toarray"><a class="viewcode-back" href="../../../timetools.html#hydpy.core.timetools.Date.toarray">[docs]</a>    <span class="k">def</span> <span class="nf">toarray</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a 1-dimensional :mod:`numpy` :class:`~numpy.ndarray` with</span>
<span class="sd">        six entries defining the actual date (year, month, day, hour, minute,</span>
<span class="sd">        second).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">minute</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">second</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_getrefmonth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;First month of the hydrological year. The default value is 11</span>
<span class="sd">        (November which is the german reference month). Setting it e.g. to 10</span>
<span class="sd">        (October is another common reference month many different countries)</span>
<span class="sd">        affects all :class:`Date` instances.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Date</span><span class="o">.</span><span class="n">_firstmonth_wateryear</span>
    <span class="k">def</span> <span class="nf">_setrefmonth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Date</span><span class="o">.</span><span class="n">_firstmonth_wateryear</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">months</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;jan&#39;</span><span class="p">,</span> <span class="s1">&#39;feb&#39;</span><span class="p">,</span> <span class="s1">&#39;mar&#39;</span><span class="p">,</span> <span class="s1">&#39;apr&#39;</span><span class="p">,</span> <span class="s1">&#39;may&#39;</span><span class="p">,</span> <span class="s1">&#39;jun&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;jul&#39;</span><span class="p">,</span> <span class="s1">&#39;aug&#39;</span><span class="p">,</span> <span class="s1">&#39;sew&#39;</span><span class="p">,</span> <span class="s1">&#39;oct&#39;</span><span class="p">,</span> <span class="s1">&#39;nov&#39;</span><span class="p">,</span> <span class="s1">&#39;dec&#39;</span><span class="p">]</span>
                <span class="n">Date</span><span class="o">.</span><span class="n">_firstmonth_wateryear</span> <span class="o">=</span> <span class="n">months</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The given value `</span><span class="si">%s</span><span class="s1">` cannot be interpreted &#39;</span>
                                 <span class="s1">&#39;as a month. Supply e.g. a number between 1 &#39;</span>
                                 <span class="s1">&#39;and 12 or a month name instead.&#39;</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>
    <span class="n">refmonth</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getrefmonth</span><span class="p">,</span> <span class="n">_setrefmonth</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getstyle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Date format style to be applied in printing.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;iso&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_style</span>
    <span class="k">def</span> <span class="nf">_setstyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">style</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_formatstrings</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="o">=</span> <span class="n">style</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;Date format style `</span><span class="si">%s</span><span class="s1">` is not available.&#39;</span> <span class="o">%</span> <span class="n">style</span><span class="p">)</span>
    <span class="n">style</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getstyle</span><span class="p">,</span> <span class="n">_setstyle</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setthing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thing</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convenience method for `_setyear`, `_setmonth`...&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Changing the </span><span class="si">%s</span><span class="s1"> of a `Date` instance is only &#39;</span>
                             <span class="s1">&#39;allowed via numbers, but the given value `</span><span class="si">%s</span><span class="s1">` &#39;</span>
                             <span class="s1">&#39;is of type `</span><span class="si">%s</span><span class="s1">` instead.&#39;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="n">thing</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;minute&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="n">unit</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="n">thing</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getsecond</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The actual second.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">second</span>
    <span class="k">def</span> <span class="nf">_setsecond</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">second</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setthing</span><span class="p">(</span><span class="s1">&#39;second&#39;</span><span class="p">,</span> <span class="n">second</span><span class="p">)</span>
    <span class="n">second</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getsecond</span><span class="p">,</span> <span class="n">_setsecond</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getminute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The actual minute.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">minute</span>
    <span class="k">def</span> <span class="nf">_setminute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minute</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setthing</span><span class="p">(</span><span class="s1">&#39;minute&#39;</span><span class="p">,</span> <span class="n">minute</span><span class="p">)</span>
    <span class="n">minute</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getminute</span><span class="p">,</span> <span class="n">_setminute</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_gethour</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The actual hour.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">hour</span>
    <span class="k">def</span> <span class="nf">_sethour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hour</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setthing</span><span class="p">(</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="n">hour</span><span class="p">)</span>
    <span class="n">hour</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_gethour</span><span class="p">,</span> <span class="n">_sethour</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getday</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The actual day.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">day</span>
    <span class="k">def</span> <span class="nf">_setday</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">day</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setthing</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="n">day</span><span class="p">)</span>
    <span class="n">day</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getday</span><span class="p">,</span> <span class="n">_setday</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getmonth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The actual month.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">month</span>
    <span class="k">def</span> <span class="nf">_setmonth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">month</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setthing</span><span class="p">(</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="n">month</span><span class="p">)</span>
    <span class="n">month</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getmonth</span><span class="p">,</span> <span class="n">_setmonth</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getyear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The actual year.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">year</span>
    <span class="k">def</span> <span class="nf">_setyear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">year</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setthing</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
    <span class="n">year</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getyear</span><span class="p">,</span> <span class="n">_setyear</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getwateryear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The actual hydrological year according selected reference month.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">month</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_firstmonth_wateryear</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">year</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">year</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">wateryear</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getwateryear</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dayofyear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Day of year as an integer value.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">timetuple</span><span class="p">()</span><span class="o">.</span><span class="n">tm_yday</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">leapyear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether the actual date falls in a leap year or not.&quot;&quot;&quot;</span>
        <span class="n">year</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">year</span>
        <span class="k">return</span> <span class="p">(((</span><span class="n">year</span> <span class="o">%</span> <span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span>
                <span class="p">(((</span><span class="n">year</span> <span class="o">%</span> <span class="mi">100</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">((</span><span class="n">year</span> <span class="o">%</span> <span class="mi">400</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)))</span>

<div class="viewcode-block" id="Date.copy"><a class="viewcode-back" href="../../../timetools.html#hydpy.core.timetools.Date.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a deep copy of the :class:`Date` instance.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">new</span> <span class="o">=</span> <span class="n">Date</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">+</span> <span class="n">Period</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">timedelta</span><span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">style</span>
        <span class="k">return</span> <span class="n">new</span>

    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">+=</span> <span class="n">Period</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">timedelta</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Period</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datetime</span><span class="o">-</span><span class="n">Date</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">new</span> <span class="o">=</span> <span class="n">Date</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datetime</span><span class="o">-</span><span class="n">Period</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">timedelta</span><span class="p">)</span>
                <span class="n">new</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">style</span>
                <span class="k">return</span> <span class="n">new</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Object `</span><span class="si">%s</span><span class="s1">` of type `</span><span class="si">%s</span><span class="s1">` can not be &#39;</span>
                                <span class="s1">&#39;substracted from a `Date` instance.&#39;</span>
                                <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">-=</span> <span class="n">Period</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">timedelta</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">&lt;</span> <span class="n">Date</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span>

    <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">&lt;=</span> <span class="n">Date</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">==</span> <span class="n">Date</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">!=</span> <span class="n">Date</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span>

    <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">&gt;</span> <span class="n">Date</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span>

    <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">&gt;=</span> <span class="n">Date</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span>

<div class="viewcode-block" id="Date.string"><a class="viewcode-back" href="../../../timetools.html#hydpy.core.timetools.Date.string">[docs]</a>    <span class="k">def</span> <span class="nf">string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">style</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a :class:`str` object representing the actual date in</span>
<span class="sd">        accordance with the given style.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">style</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">style</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">retain</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_formatstrings</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Date(&quot;</span><span class="si">%s</span><span class="s1">&quot;)&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">dir_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="Period"><a class="viewcode-back" href="../../../timetools.html#hydpy.core.timetools.Period">[docs]</a><span class="k">class</span> <span class="nc">Period</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Handles the length of a single time period.</span>

<span class="sd">    Argument:</span>
<span class="sd">        * period (:class:`~datetime.timedelta` or :class:`str`): Period length.</span>

<span class="sd">    Attribute:</span>
<span class="sd">        * datetime (:class:`~datetime.timedelta`): The core of :class:`Period`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">period</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">Period</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">=</span> <span class="n">period</span><span class="o">.</span><span class="n">timedelta</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">period</span><span class="o">.</span><span class="n">microseconds</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;For `Period` instances, microseconds must &#39;</span>
                                 <span class="s1">&#39;`0`.  For the given `timedelta` object, it &#39;</span>
                                 <span class="s1">&#39;is `</span><span class="si">%d</span><span class="s1">` instead.&#39;</span> <span class="o">%</span> <span class="n">period</span><span class="o">.</span><span class="n">microseconds</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">=</span> <span class="n">period</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">period</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initfromstr</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The supplied argument must be either an &#39;</span>
                             <span class="s1">&#39;instance of `datetime.timedelta` or `str`.  &#39;</span>
                             <span class="s1">&#39;The given arguments type is </span><span class="si">%s</span><span class="s1">.&#39;</span>
                             <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">period</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_initfromstr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">period</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Try to initialize `timedelta` from the given :class:`str` instance.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            * period (:class:`str`): Period length.</span>
<span class="sd">         &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">period</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;All characters of the given period string, &#39;</span>
                             <span class="s1">&#39;except the last one which represents the unit, &#39;</span>
                             <span class="s1">&#39;need to define a whole decimal number.  Instead,&#39;</span>
                             <span class="s1">&#39; these characters are `</span><span class="si">%s</span><span class="s1">`.&#39;</span> <span class="o">%</span> <span class="n">period</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span> <span class="o">=</span> <span class="n">period</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The last character of the given period string &#39;</span>
                             <span class="s1">&#39;needs to be either `d` (days), `h` (hours) or &#39;</span>
                             <span class="s1">&#39;`m` (minutes).  Instead, the last character is &#39;</span>
                             <span class="s1">&#39;`</span><span class="si">%s</span><span class="s1">`.&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span> <span class="o">==</span> <span class="s1">&#39;h&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">number</span><span class="o">*</span><span class="mi">3600</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">number</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Period.fromseconds"><a class="viewcode-back" href="../../../timetools.html#hydpy.core.timetools.Period.fromseconds">[docs]</a>    <span class="k">def</span> <span class="nf">fromseconds</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">seconds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a :class:`Period` instance based on a given number of</span>
<span class="sd">        seconds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="n">seconds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">seconds</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">seconds</span><span class="p">)))</span></div>

    <span class="k">def</span> <span class="nf">_guessunit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Guess the unit of the period as the largest one, which results in</span>
<span class="sd">        an integer duration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">days</span> <span class="o">%</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;d&#39;</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">hours</span> <span class="o">%</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;h&#39;</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">minutes</span> <span class="o">%</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;m&#39;</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">seconds</span> <span class="o">%</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;s&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The stepsize is not a multiple of one &#39;</span>
                             <span class="s1">&#39;second, which is not allowed.&#39;</span><span class="p">)</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_guessunit</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getseconds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Period length in seconds.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">timedelta</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
    <span class="n">seconds</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getseconds</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getminutes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Period length in minutes.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seconds</span> <span class="o">/</span> <span class="mi">60</span>
    <span class="n">minutes</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getminutes</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_gethours</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Period length in hours.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">minutes</span> <span class="o">/</span> <span class="mi">60</span>
    <span class="n">hours</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_gethours</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getdays</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Period length in days.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hours</span> <span class="o">/</span> <span class="mi">24</span>
    <span class="n">days</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getdays</span><span class="p">)</span>

<div class="viewcode-block" id="Period.copy"><a class="viewcode-back" href="../../../timetools.html#hydpy.core.timetools.Period.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a deep copy of the :class:`Period` instance.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="n">Date</span><span class="p">(</span><span class="n">Date</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">datetime</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">timedelta</span><span class="p">)</span>
            <span class="n">new</span><span class="o">.</span><span class="n">style</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">style</span>
            <span class="k">return</span> <span class="n">new</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Period</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">+</span> <span class="n">Period</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">timedelta</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Object `</span><span class="si">%s</span><span class="s1">` of type `</span><span class="si">%s</span><span class="s1">` can not be &#39;</span>
                                <span class="s1">&#39;added to a `Period` instance.&#39;</span>
                                <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="p">),</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">+=</span> <span class="n">Period</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">timedelta</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Period</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">-</span> <span class="n">Period</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">timedelta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">-=</span> <span class="n">Period</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">timedelta</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Period</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">*</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__imul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">*=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Period</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">//</span> <span class="n">other</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seconds</span> <span class="o">/</span> <span class="n">Period</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">seconds</span>

    <span class="k">def</span> <span class="nf">__itruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="o">/</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__mod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seconds</span> <span class="o">%</span> <span class="n">Period</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span> <span class="o">!=</span> <span class="mf">0.</span>

    <span class="k">def</span> <span class="nf">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seconds</span> <span class="o">%</span> <span class="n">Period</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span> <span class="o">==</span> <span class="mf">0.</span>

    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">&lt;</span> <span class="n">Period</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">timedelta</span>

    <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">&lt;=</span> <span class="n">Period</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">timedelta</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">==</span> <span class="n">Period</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">timedelta</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">!=</span> <span class="n">Period</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">timedelta</span>

    <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">&gt;</span> <span class="n">Period</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">timedelta</span>

    <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">timedelta</span> <span class="o">&gt;=</span> <span class="n">Period</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">timedelta</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">d&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">days</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;h&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">h&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">hours</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">m&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">minutes</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">s&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">seconds</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;Period(&quot;</span><span class="si">%s</span><span class="s1">&quot;)&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">dir_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<div class="viewcode-block" id="Timegrid"><a class="viewcode-back" href="../../../timetools.html#hydpy.core.timetools.Timegrid">[docs]</a><span class="k">class</span> <span class="nc">Timegrid</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Handle a time period defined by to dates and a step size in between.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">firstdate</span><span class="p">,</span> <span class="n">lastdate</span><span class="p">,</span> <span class="n">stepsize</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_firstdate</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lastdate</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stepsize</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">firstdate</span> <span class="o">=</span> <span class="n">firstdate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastdate</span> <span class="o">=</span> <span class="n">lastdate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stepsize</span> <span class="o">=</span> <span class="n">stepsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_getfirstdate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_firstdate</span>
    <span class="k">def</span> <span class="nf">_setfirstdate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">firstdate</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_firstdate</span> <span class="o">=</span> <span class="n">Date</span><span class="p">(</span><span class="n">firstdate</span><span class="p">)</span>
    <span class="n">firstdate</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getfirstdate</span><span class="p">,</span> <span class="n">_setfirstdate</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getlastdate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lastdate</span>
    <span class="k">def</span> <span class="nf">_setlastdate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lastdate</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lastdate</span> <span class="o">=</span> <span class="n">Date</span><span class="p">(</span><span class="n">lastdate</span><span class="p">)</span>
    <span class="n">lastdate</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getlastdate</span><span class="p">,</span> <span class="n">_setlastdate</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getstepsize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stepsize</span>
    <span class="k">def</span> <span class="nf">_setstepsize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stepsize</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_stepsize</span> <span class="o">=</span> <span class="n">Period</span><span class="p">(</span><span class="n">stepsize</span><span class="p">)</span>
    <span class="n">stepsize</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getstepsize</span><span class="p">,</span> <span class="n">_setstepsize</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="Timegrid.fromarray"><a class="viewcode-back" href="../../../timetools.html#hydpy.core.timetools.Timegrid.fromarray">[docs]</a>    <span class="k">def</span> <span class="nf">fromarray</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a :class:`Timegrid` instance based on two date and one</span>
<span class="sd">        period information stored in the first 13 rows of a</span>
<span class="sd">        :class:`~numpy.ndarray` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">firstdate</span><span class="o">=</span><span class="n">Date</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">array</span><span class="p">[:</span><span class="mi">6</span><span class="p">]),</span>
                       <span class="n">lastdate</span><span class="o">=</span><span class="n">Date</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">12</span><span class="p">]),</span>
                       <span class="n">stepsize</span><span class="o">=</span><span class="n">Period</span><span class="o">.</span><span class="n">fromseconds</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="mi">12</span><span class="p">]))</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;To define a Timegrid instance via an array, 13 &#39;</span>
                             <span class="s1">&#39;numbers are required.  However, the given array &#39;</span>
                             <span class="s1">&#39;consist of </span><span class="si">%d</span><span class="s1"> entries/rows only.&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">))</span></div>

<div class="viewcode-block" id="Timegrid.toarray"><a class="viewcode-back" href="../../../timetools.html#hydpy.core.timetools.Timegrid.toarray">[docs]</a>    <span class="k">def</span> <span class="nf">toarray</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a 1-dimensional :mod:`numpy` :class:`~numpy.ndarray` with</span>
<span class="sd">        thirteen entries first defining the start date, secondly defining the</span>
<span class="sd">        end date and thirdly the step size.&quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">values</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstdate</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
        <span class="n">values</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastdate</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
        <span class="n">values</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsize</span><span class="o">.</span><span class="n">seconds</span>
        <span class="k">return</span> <span class="n">values</span></div>

<div class="viewcode-block" id="Timegrid.verify"><a class="viewcode-back" href="../../../timetools.html#hydpy.core.timetools.Timegrid.verify">[docs]</a>    <span class="k">def</span> <span class="nf">verify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Raise an :class:`~exceptions.ValueError` if the dates or the</span>
<span class="sd">        step size of the time frame are inconsistent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstdate</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastdate</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unplausible timegrid. The first given &#39;</span>
                             <span class="s1">&#39;date </span><span class="si">%s</span><span class="s1">, the second given date is </span><span class="si">%s</span><span class="s1">. &#39;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">firstdate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastdate</span><span class="p">))</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lastdate</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">firstdate</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsize</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unplausible timegrid. The period span &#39;</span>
                             <span class="s1">&#39;between the given dates </span><span class="si">%s</span><span class="s1"> and </span><span class="si">%s</span><span class="s1"> is not &#39;</span>
                             <span class="s1">&#39;a multiple of the given step size </span><span class="si">%s</span><span class="s1">.&#39;</span> <span class="o">%</span>
                             <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">firstdate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastdate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsize</span><span class="p">))</span></div>

<div class="viewcode-block" id="Timegrid.copy"><a class="viewcode-back" href="../../../timetools.html#hydpy.core.timetools.Timegrid.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a deep copy of the :class:`Timegrid` instance.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">lastdate</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">firstdate</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsize</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Date</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">firstdate</span> <span class="o">+</span> <span class="n">key</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">stepsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">Date</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="n">key</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">firstdate</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsize</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">%</span> <span class="mf">1.</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The given date `</span><span class="si">%s</span><span class="s1">` is not properly &#39;</span>
                                 <span class="s1">&#39;alligned on the indexed timegrid.&#39;</span> <span class="o">%</span>  <span class="n">key</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">firstdate</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">date</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastdate</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">date</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">date</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsize</span>

    <span class="k">def</span> <span class="nf">_containsdate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">Date</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">firstdate</span> <span class="o">&lt;=</span> <span class="n">date</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastdate</span><span class="p">)</span> <span class="ow">and</span>
                <span class="p">((</span><span class="n">date</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">firstdate</span><span class="p">)</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsize</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_containstimegrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timegrid</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_containsdate</span><span class="p">(</span><span class="n">timegrid</span><span class="o">.</span><span class="n">firstdate</span><span class="p">)</span> <span class="ow">and</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_containsdate</span><span class="p">(</span><span class="n">timegrid</span><span class="o">.</span><span class="n">lastdate</span><span class="p">)</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">timegrid</span><span class="o">.</span><span class="n">stepsize</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsize</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Timegrid</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containstimegrid</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_containsdate</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">firstdate</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">firstdate</span><span class="p">)</span> <span class="ow">and</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lastdate</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">lastdate</span><span class="p">)</span> <span class="ow">and</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stepsize</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">stepsize</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">firstdate</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">firstdate</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lastdate</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">lastdate</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stepsize</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">stepsize</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;from </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1"> in </span><span class="si">%s</span><span class="s1"> steps&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">firstdate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastdate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsize</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignrepr</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Timegrid.assignrepr"><a class="viewcode-back" href="../../../timetools.html#hydpy.core.timetools.Timegrid.assignrepr">[docs]</a>    <span class="k">def</span> <span class="nf">assignrepr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a :func:`repr` string with an prefixed assignement.</span>

<span class="sd">        Argument:</span>
<span class="sd">            * prefix(:class:`str`): Usually something like &#39;x = &#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">skip</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="o">+</span> <span class="mi">9</span>
        <span class="n">blanks</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="n">skip</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">Timegrid(&quot;</span><span class="si">%s</span><span class="s1">&quot;,&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">firstdate</span><span class="p">)),</span>
                 <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&quot;</span><span class="si">%s</span><span class="s1">&quot;,&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">blanks</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lastdate</span><span class="p">)),</span>
                 <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&quot;</span><span class="si">%s</span><span class="s1">&quot;)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">blanks</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stepsize</span><span class="p">))]</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">dir_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">_Timegrids</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Handle all :class:`Timegrid` instances of a HydPy application.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        * info (:class:`dict`): Dictionary containing initialisation</span>
<span class="sd">          information, usually defined within the main project file.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        * data (:class:`Timegrid`): For the available data stored on disk.</span>
<span class="sd">        * init (:class:`Timegrid`): For the initialisation period.</span>
<span class="sd">        * sim (:class:`Timegrid`): For the simulation period.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;date_startdata&#39;</span><span class="p">,</span> <span class="s1">&#39;date_enddata&#39;</span><span class="p">,</span> <span class="s1">&#39;timestep&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;The information `</span><span class="si">%s</span><span class="s1">` is missing. Usually, &#39;</span>
                               <span class="s1">&#39;it is defined within the main project file.&#39;</span>
                               <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">Timegrid</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">Timegrid</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date_startinit&#39;</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">firstdate</span><span class="o">.</span><span class="n">copy</span><span class="p">()),</span>
                             <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date_endinit&#39;</span><span class="p">,</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lastdate</span><span class="o">.</span><span class="n">copy</span><span class="p">()),</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">stepsize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sim</span> <span class="o">=</span> <span class="n">Timegrid</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date_startsim&#39;</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">firstdate</span><span class="o">.</span><span class="n">copy</span><span class="p">()),</span>
                            <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date_endsim&#39;</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">lastdate</span><span class="o">.</span><span class="n">copy</span><span class="p">()),</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">stepsize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_getstepsize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stepsize of all handled :class:`Timegrid` objects.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">stepsize</span>
    <span class="k">def</span> <span class="nf">_setstepsize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stepsize</span><span class="p">):</span>
        <span class="n">stepsize</span> <span class="o">=</span> <span class="n">Period</span><span class="p">(</span><span class="n">stepsize</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">timegrid</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">timegrid</span><span class="o">.</span><span class="n">stepsize</span> <span class="o">=</span> <span class="n">stepsize</span>
    <span class="n">stepsize</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getstepsize</span><span class="p">,</span> <span class="n">_setstepsize</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">verify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Raise an :class:`~exceptions.RuntimeError` it the different</span>
<span class="sd">        time grids are inconsistent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">firstdate</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">firstdate</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The first date of the data period (</span><span class="si">%s</span><span class="s1">) must &#39;</span>
                               <span class="s1">&#39;not be later than the first date of the &#39;</span>
                               <span class="s1">&#39;initialisation period  (</span><span class="si">%s</span><span class="s1">).&#39;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">firstdate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">firstdate</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lastdate</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">lastdate</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The last date of the data period (</span><span class="si">%s</span><span class="s1">) must &#39;</span>
                               <span class="s1">&#39;not be earlier than the last date of the &#39;</span>
                               <span class="s1">&#39;initialisation period  (</span><span class="si">%s</span><span class="s1">).&#39;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lastdate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">lastdate</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">firstdate</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">firstdate</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The first date of the initialisation period &#39;</span>
                               <span class="s1">&#39;(</span><span class="si">%s</span><span class="s1">) must not be later than the first date &#39;</span>
                               <span class="s1">&#39;of the simulation period  (</span><span class="si">%s</span><span class="s1">).&#39;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">firstdate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">firstdate</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">lastdate</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">lastdate</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The last date of the initialisation period &#39;</span>
                               <span class="s1">&#39;(</span><span class="si">%s</span><span class="s1">) must not be earlier than the last date &#39;</span>
                               <span class="s1">&#39;of the simulation period  (</span><span class="si">%s</span><span class="s1">).&#39;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">lastdate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">lastdate</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">stepsize</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">stepsize</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The data stepsize (</span><span class="si">%s</span><span class="s1">) must be identical with &#39;</span>
                               <span class="s1">&#39;the initialisation stepsize (</span><span class="si">%s</span><span class="s1">).&#39;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">stepsize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">stepsize</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">stepsize</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">stepsize</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The initialization stepsize (</span><span class="si">%s</span><span class="s1">) must be &#39;</span>
                               <span class="s1">&#39;identical with the simulation stepsize (</span><span class="si">%s</span><span class="s1">).&#39;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">stepsize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">stepsize</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">firstdate</span><span class="p">]</span> <span class="o">%</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The initialization time grid is not properly &#39;</span>
                               <span class="s1">&#39;alligned on the data time grid.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">firstdate</span><span class="p">]</span> <span class="o">%</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The simulation time grid is not properly &#39;</span>
                               <span class="s1">&#39;alligned on the initialization time grid.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qfactor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">area</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the factor for converting `mm/stepsize` to `m^3/s`.</span>

<span class="sd">        Argument:</span>
<span class="sd">            * area (:class:`float`): Reference area, which must be given in</span>
<span class="sd">              the unit `km^2`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">area</span> <span class="o">*</span> <span class="mf">1000.</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsize</span><span class="o">.</span><span class="n">seconds</span>

    <span class="k">def</span> <span class="nf">parfactor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stepsize</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the factor for converting parameter to simulation step size.</span>

<span class="sd">        Argument:</span>
<span class="sd">            * stepsize (:class:`Period` or an suitable initialization argument</span>
<span class="sd">              thereof): Time interval, to which the parameter values refer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsize</span> <span class="o">/</span> <span class="n">Period</span><span class="p">(</span><span class="n">stepsize</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a deep copy of the :class:`Timegrids` instance.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">timegrid</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">timegrid</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;All timegrids of the current project.&#39;</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dic</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;timestep&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">stepsize</span><span class="p">,</span>
               <span class="s1">&#39;date_startdata&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">firstdate</span><span class="p">,</span>
               <span class="s1">&#39;date_enddata&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lastdate</span><span class="p">,</span>
               <span class="s1">&#39;date_startinit&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">firstdate</span><span class="p">,</span>
               <span class="s1">&#39;date_endinit&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">lastdate</span><span class="p">,</span>
               <span class="s1">&#39;date_startsim&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">firstdate</span><span class="p">,</span>
               <span class="s1">&#39;date_endsim&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">lastdate</span><span class="p">}</span>
        <span class="k">return</span> <span class="s1">&#39;Timegrids(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">dic</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">dir_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<div class="viewcode-block" id="Timegrids"><a class="viewcode-back" href="../../../timetools.html#hydpy.core.timetools.Timegrids">[docs]</a><span class="k">class</span> <span class="nc">Timegrids</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Handle all :class:`Timegrid` instances of a HydPy application.</span>

<span class="sd">    Arguments and Attributes:</span>
<span class="sd">        * data (:class:`Timegrid`): For the available data stored on disk.</span>
<span class="sd">        * init (:class:`Timegrid`, optional): For the initialisation</span>
<span class="sd">          period.  If not supplied, the specifications of the `data`</span>
<span class="sd">          :class:`Timegrid` are applied.</span>
<span class="sd">        * sim (:class:`Timegrid`, optional): For the simulation period.</span>
<span class="sd">          If not supplied, the specifications of the `init` :class:`Timegrid`</span>
<span class="sd">          are applied.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">if</span> <span class="n">init</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">init</span>
        <span class="k">if</span> <span class="n">sim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sim</span> <span class="o">=</span> <span class="n">sim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_getstepsize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stepsize of all handled :class:`Timegrid` objects.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">stepsize</span>
    <span class="k">def</span> <span class="nf">_setstepsize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stepsize</span><span class="p">):</span>
        <span class="n">stepsize</span> <span class="o">=</span> <span class="n">Period</span><span class="p">(</span><span class="n">stepsize</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">timegrid</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">timegrid</span><span class="o">.</span><span class="n">stepsize</span> <span class="o">=</span> <span class="n">stepsize</span>
    <span class="n">stepsize</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_getstepsize</span><span class="p">,</span> <span class="n">_setstepsize</span><span class="p">)</span>

<div class="viewcode-block" id="Timegrids.verify"><a class="viewcode-back" href="../../../timetools.html#hydpy.core.timetools.Timegrids.verify">[docs]</a>    <span class="k">def</span> <span class="nf">verify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Raise an :class:`~exceptions.RuntimeError` it the different</span>
<span class="sd">        time grids are inconsistent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">firstdate</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">firstdate</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The first date of the data period (</span><span class="si">%s</span><span class="s1">) must &#39;</span>
                               <span class="s1">&#39;not be later than the first date of the &#39;</span>
                               <span class="s1">&#39;initialisation period  (</span><span class="si">%s</span><span class="s1">).&#39;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">firstdate</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">firstdate</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lastdate</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">lastdate</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The last date of the data period (</span><span class="si">%s</span><span class="s1">) must &#39;</span>
                               <span class="s1">&#39;not be earlier than the last date of the &#39;</span>
                               <span class="s1">&#39;initialisation period  (</span><span class="si">%s</span><span class="s1">).&#39;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">lastdate</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">lastdate</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">firstdate</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">firstdate</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The first date of the initialisation period &#39;</span>
                               <span class="s1">&#39;(</span><span class="si">%s</span><span class="s1">) must not be later than the first date &#39;</span>
                               <span class="s1">&#39;of the simulation period  (</span><span class="si">%s</span><span class="s1">).&#39;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">firstdate</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">firstdate</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">lastdate</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">lastdate</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The last date of the initialisation period &#39;</span>
                               <span class="s1">&#39;(</span><span class="si">%s</span><span class="s1">) must not be earlier than the last date &#39;</span>
                               <span class="s1">&#39;of the simulation period  (</span><span class="si">%s</span><span class="s1">).&#39;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">lastdate</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">lastdate</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">stepsize</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">stepsize</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The data stepsize (</span><span class="si">%s</span><span class="s1">) must be identical with &#39;</span>
                               <span class="s1">&#39;the initialisation stepsize (</span><span class="si">%s</span><span class="s1">).&#39;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">stepsize</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">stepsize</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">stepsize</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">stepsize</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The initialization stepsize (</span><span class="si">%s</span><span class="s1">) must be &#39;</span>
                               <span class="s1">&#39;identical with the simulation stepsize (</span><span class="si">%s</span><span class="s1">).&#39;</span>
                               <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">stepsize</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">stepsize</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">firstdate</span><span class="p">]</span> <span class="o">%</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The initialization time grid is not properly &#39;</span>
                               <span class="s1">&#39;alligned on the data time grid.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">firstdate</span><span class="p">]</span> <span class="o">%</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;The simulation time grid is not properly &#39;</span>
                               <span class="s1">&#39;alligned on the initialization time grid.&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Timegrids.qfactor"><a class="viewcode-back" href="../../../timetools.html#hydpy.core.timetools.Timegrids.qfactor">[docs]</a>    <span class="k">def</span> <span class="nf">qfactor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">area</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the factor for converting `mm/stepsize` to `m^3/s`.</span>

<span class="sd">        Argument:</span>
<span class="sd">            * area (:class:`float`): Reference area, which must be given in</span>
<span class="sd">              the unit `km^2`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">area</span> <span class="o">*</span> <span class="mf">1000.</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsize</span><span class="o">.</span><span class="n">seconds</span></div>

<div class="viewcode-block" id="Timegrids.parfactor"><a class="viewcode-back" href="../../../timetools.html#hydpy.core.timetools.Timegrids.parfactor">[docs]</a>    <span class="k">def</span> <span class="nf">parfactor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stepsize</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the factor for converting parameter to simulation step size.</span>

<span class="sd">        Argument:</span>
<span class="sd">            * stepsize (:class:`Period` or an suitable initialization argument</span>
<span class="sd">              thereof): Time interval, to which the parameter values refer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stepsize</span> <span class="o">/</span> <span class="n">Period</span><span class="p">(</span><span class="n">stepsize</span><span class="p">)</span></div>

<div class="viewcode-block" id="Timegrids.copy"><a class="viewcode-back" href="../../../timetools.html#hydpy.core.timetools.Timegrids.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a deep copy of the :class:`Timegrids` instance.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">timegrid</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">timegrid</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;All timegrids of the actual HydPy project.&#39;</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignrepr</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Timegrids.assignrepr"><a class="viewcode-back" href="../../../timetools.html#hydpy.core.timetools.Timegrids.assignrepr">[docs]</a>    <span class="k">def</span> <span class="nf">assignrepr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a :func:`repr` string with an prefixed assignement.</span>

<span class="sd">        Argument:</span>
<span class="sd">            * prefix(:class:`str`): Usually something like &#39;x = &#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">caller</span> <span class="o">=</span> <span class="s1">&#39;NewTimegrids(&#39;</span>
        <span class="n">blanks</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">caller</span><span class="p">))</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">data=&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">caller</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">assignrepr</span><span class="p">(</span><span class="n">prefix</span><span class="p">)]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">init=&#39;</span> <span class="o">%</span> <span class="n">blanks</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">assignrepr</span><span class="p">(</span><span class="n">prefix</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sim</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">sim=&#39;</span> <span class="o">%</span> <span class="n">blanks</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,&#39;</span> <span class="o">%</span>  <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">assignrepr</span><span class="p">(</span><span class="n">prefix</span><span class="p">))</span>
        <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">objecttools</span><span class="o">.</span><span class="n">dir_</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">HydPy 2.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Christoph Tyralla.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.5.
    </div>
  </body>
</html>